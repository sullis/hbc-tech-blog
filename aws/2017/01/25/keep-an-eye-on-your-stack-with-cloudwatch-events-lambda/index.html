<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Keeping an Extra Eye on Your Stack with CloudWatch Events</title><title>Keeping an Extra Eye on Your Stack with CloudWatch Events | HBC Tech</title><meta property="og:title" content="Keeping an Extra Eye on Your Stack with CloudWatch Events"><meta name="author" content="Emerson Loureiro"><meta property="og:locale" content="en_US"><meta name="description" content="Why an Extra Eye?"><meta property="og:description" content="Why an Extra Eye?"><link rel="canonical" href="https://saksdirect.github.io/hbc-tech-blog/aws/2017/01/25/keep-an-eye-on-your-stack-with-cloudwatch-events-lambda/"><meta property="og:url" content="https://saksdirect.github.io/hbc-tech-blog/aws/2017/01/25/keep-an-eye-on-your-stack-with-cloudwatch-events-lambda/"><meta property="og:site_name" content="HBC Tech"><meta property="og:type" content="article"><meta property="article:published_time" content="2017-01-25T00:00:00-05:00"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@"><meta name="twitter:creator" content="@Emerson Loureiro"><script type="application/ld+json">{"name":null,"description":"Why an Extra Eye?","author":{"@type":"Person","name":"Emerson Loureiro"},"@type":"BlogPosting","url":"https://saksdirect.github.io/hbc-tech-blog/aws/2017/01/25/keep-an-eye-on-your-stack-with-cloudwatch-events-lambda/","publisher":null,"image":null,"headline":"Keeping an Extra Eye on Your Stack with CloudWatch Events","dateModified":"2017-01-25T00:00:00-05:00","datePublished":"2017-01-25T00:00:00-05:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"https://saksdirect.github.io/hbc-tech-blog/aws/2017/01/25/keep-an-eye-on-your-stack-with-cloudwatch-events-lambda/"},"@context":"http://schema.org"}</script><link rel="stylesheet" href="https://saksdirect.github.io/hbc-tech-blog/assets/css/main.css"><link rel="canonical" href="https://saksdirect.github.io/hbc-tech-blog/aws/2017/01/25/keep-an-eye-on-your-stack-with-cloudwatch-events-lambda/"><link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,700" rel="stylesheet"><link rel="shortcut icon" href="https://saksdirect.github.io/hbc-tech-blog/assets/images/favicon.ico"></head><body class="container" aria-label="Content"><header id="site-header" class="site-header"><a class="site-header__logo" href="https://saksdirect.github.io/hbc-tech-blog/"><svg class="hbc-tech-logo" xmlns="http://www.w3.org/2000/svg"><use class="hbc-tech-logo__hbc" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#hbc"></use><use class="hbc-tech-logo__beaver" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#beaver"></use><use class="hbc-tech-logo__tech" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#tech"></use><use class="hbc-tech-logo__beta" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#beta"></use></svg></a><p class="sticky-nav-meta"><a href="https://saksdirect.github.io/hbc-tech-blog/categories/#aws" class="meta__category">aws</a> <span class="meta__title">Keeping an Extra Eye on Your Stack with CloudWatch Events</span></p><ul class="navigation"><li class="navigation__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/insights" class="navigation__link"><span class="navigation__link-highlight">Insights</span></a></li><li class="navigation__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/code" class="navigation__link"><span class="navigation__link-highlight">Code</span></a></li><li class="navigation__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/culture" class="navigation__link"><span class="navigation__link-highlight">Culture</span></a></li><li class="navigation__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/jobs" class="navigation__link"><span class="navigation__link-highlight">Work Here</span></a></li></ul></header><section class="content"><article class="article"><section class="article__no-feature-image"></section><section class="article__content"><div class="article-meta"><a href="https://saksdirect.github.io/hbc-tech-blog/categories/#aws" class="article-meta__category">aws</a> <span class="article-meta__date">Published 25 JAN 2017</span></div><h1 class="article__content__title" title="Keeping an Extra Eye on Your Stack with CloudWatch Events">Keeping an Extra Eye on Your Stack with CloudWatch Events</h1><div class="article__content__read-time"><span class="read-time" title="Estimated read time"><span class="read-time__text-1">15 mins</span> <span class="read-time__text-2">Read</span> <span class="read-time__text-3">Time</span></span></div><div class="article__content__share-buttons"><ul class="share-buttons"><li class="share-buttons__link-item"><a href="https://twitter.com/intent/tweet?text=https://saksdirect.github.io/hbc-tech-blog//aws/2017/01/25/keep-an-eye-on-your-stack-with-cloudwatch-events-lambda/" class="share-buttons__link" title="Share on Twitter"><svg class="hbc-svg-icon" height="36" width="36" xmlns="http://www.w3.org/2000/svg"><use class="hbc-svg-icon--twitter" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#twitter"></use></svg></a></li><li class="share-buttons__link-item"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://saksdirect.github.io/hbc-tech-blog/&source=/aws/2017/01/25/keep-an-eye-on-your-stack-with-cloudwatch-events-lambda/&title=Keeping an Extra Eye on Your Stack with CloudWatch Events" class="share-buttons__link" title="Share on Linkedin"><svg height="36" width="36" xmlns="http://www.w3.org/2000/svg"><use class="hbc-svg-icon" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#linkedin"></use></svg></a></li><li class="share-buttons__link-item"><a href="https://www.facebook.com/sharer/sharer.php?u=https://saksdirect.github.io/hbc-tech-blog//aws/2017/01/25/keep-an-eye-on-your-stack-with-cloudwatch-events-lambda/" class="share-buttons__link" title="Share on Facebook"><svg height="36" width="36" xmlns="http://www.w3.org/2000/svg"><use class="hbc-svg-icon" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#facebook"></use></svg></a></li><li class="share-buttons__link-item"><a href="https://www.reddit.com/submit?url=https://saksdirect.github.io/hbc-tech-blog//aws/2017/01/25/keep-an-eye-on-your-stack-with-cloudwatch-events-lambda/" class="share-buttons__link" title="Share on Reddit"><svg height="36" width="36" xmlns="http://www.w3.org/2000/svg"><use class="hbc-svg-icon" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#reddit"></use></svg></a></li></ul></div><div class="article__content__body"><h1 id="why-an-extra-eye">Why an Extra Eye?</h1><p>There’s a lot going on in AWS; EC2 instances coming up, new releases being rolled out, services scaling up and down, new services and the underlying infrastructure being setup. If you own software running production, you probably know the drill; you need to ensure that the software and its supporting infrastructure are healthy and stable. You will also eventually need to diagnose production issues. In short, you need a way to keep an eye on your software. The scale at which we run things here at <a href="http://www.gilt.com">Gilt</a>, with over 300 services in production, each with multiple instances, means this is even more important.</p><p>In AWS, <a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/WhatIsCloudWatchEvents.html">CloudWatch Events</a> is a powerful tool for monitoring your resources. In very simple terms, it allows you to receive notifications about some of your infrastructure in production, and then lets you decide what to do with it. This last part is where Lambdas come in, and I’ll go into the details of how that’s done in a minute. First, let’s look at some of the events you can receive with CloudWatch.</p><ul><li><strong>EC2</strong>: instance state changes (<em>starting</em>, <em>running</em>, <em>stopping</em>, <em>stopped</em>, and <em>terminated</em>);</li><li><strong>CodeDeploy</strong>: deployment state changes (<em>started</em>, <em>succeeded</em>, <em>failed</em>);</li><li><strong>AutoScaling</strong>: instance terminated, instance added to AutoScaling Group;</li><li><strong>ECS</strong>: task state changes</li></ul><h1 id="the-basic-framework">The Basic Framework</h1><p>The framework for consuming these events consists of three parts: a <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-events-rule.html"><strong>CloudWatch rule</strong></a>, a <a href="http://docs.aws.amazon.com/lambda/latest/dg/intro-permission-model.html"><strong>permission</strong></a>, and a <strong>target</strong>. In our case, the target is a <a href="https://aws.amazon.com/lambda/">Lambda</a>, but it can also be a SQS queue, an SNS topic and a few other things. The CloudWatch rule determines the actual event you are interested in receiving. The Lambda is what will receive the event and allow you to act on it (e.g., send an email notification). Finally, the permission binds the rule to the Lambda, enabling the Lambda invocation whenever the rule is met.</p><p>In a little bit more details, the CloudWatch rule consists of a <code class="highlighter-rouge">source</code> - i.e., the AWS service where the event originates - a <code class="highlighter-rouge">detail-type</code>, specifying the specific event you are interested in receiving - e.g., failed deployments - and finally a <code class="highlighter-rouge">detail</code> which is essentially a filter. For CodeDeploy deployments, for example, that would be which deployment groups the events should be fired for. Here’s an example of a rule we actually use in production at <a href="http://www.gilt.com">Gilt</a>. This rule will fire events whenever instances under the production and canary <a href="https://aws.amazon.com/autoscaling/">AutoScaling</a> groups of the service <code class="highlighter-rouge">some-service</code> are terminated.</p><div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"detail-type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"EC2 Instance Terminate Successful"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"aws.autoscaling"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"detail"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"AutoScalingGroupName"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"some-service-production-auto-scaling-group"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"some-service-canary-auto-scaling-group"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><p>You can create the rule in different ways, for example via the console, and the code snippet above is the representation of the rule from CloudWatch’s point of view. Here at <a href="http://www.gilt.com">Gilt</a>, we usually use <a href="https://aws.amazon.com/cloudformation/">CloudFormation</a> stacks for creating resources like that, and I will illustrate how to do that in a little while.</p><p>But, first, how exactly have we been using that? There are two use cases, actually. In one case, we want to be notified when an instance is terminated due to a healthcheck failure. This essentially means that the instance was running and healthy, but for whatever reason the healthcheck failed for some amount of time, and the instance was killed by the auto scaling group. This is definitely something we want to be aware of, as it may indicate a pattern on certain services - e.g., the instance type for this service is no longer enough, as it keeps on dying with an out of memory error. The other use case is for deployments. Either to know when the deployment for a new release is finished, or to help piecing together a timeline of events when investigating production issues.</p><h1 id="the-cloudwatch-and-lambda-setup">The CloudWatch and Lambda Setup</h1><p>Now let’s get into the details of how we have set that up, starting with the instance termination events. As I said early on, for creating resources in AWS, typically we rely on CloudFormation stacks, so it’s no different with our CloudWatch event + Lambda setup. Here’s the CloudFormation template that creates the CloudWatch rule for instance termination events.</p><div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">InstanceTerminationEvent</span><span class="pi">:</span>
    <span class="s">Type</span><span class="pi">:</span> <span class="s">AWS::Events::Rule</span>
    <span class="s">Properties</span><span class="pi">:</span>
      <span class="s">Name</span><span class="pi">:</span> <span class="s">my-instance-termination-rule</span>
      <span class="s">State</span><span class="pi">:</span> <span class="s">ENABLED</span>
      <span class="s">Targets</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">Arn</span><span class="pi">:</span> <span class="s">arn:aws:lambda:us-east-1:123456789:function:my-instance-termination-lambda-function</span>
          <span class="s">Id</span><span class="pi">:</span> <span class="s">my-instance-termination-rule-target</span>
      <span class="s">EventPattern</span><span class="pi">:</span>
        <span class="s">source</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">aws.autoscaling'</span><span class="pi">]</span>
        <span class="s">detail-type</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">EC2</span><span class="nv"> </span><span class="s">Instance</span><span class="nv"> </span><span class="s">Terminate</span><span class="nv"> </span><span class="s">Successful'</span><span class="pi">]</span>
        <span class="s">detail</span><span class="pi">:</span>
          <span class="s">AutoScalingGroupName</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="kt">!Ref</span> <span class="s">YourAutoScalingGroup</span>
            <span class="pi">-</span> <span class="kt">!Ref</span> <span class="s">AnotherOfYourAutoScalingGroup</span>
</code></pre></div><p>When the rule is matched to an event, given the conditions stated on the template, it will invoke the target - in this case a Lambda. The ARN of the Lambda is then provided as the value of the target. This rule is essentially stating that, when an EC2 instance is terminated within the auto scaling groups defined, the Lambda should be triggered. The event itself is then used as the input to the Lambda.</p><p>Remember though that you also need a permission to allow the rule to invoke the target. Here’s how we define it on a CloudFormation template.</p><div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">InstanceTerminationLambdaPermission</span><span class="pi">:</span>
    <span class="s">Type</span><span class="pi">:</span> <span class="s">AWS::Lambda::Permission</span>
    <span class="s">Properties</span><span class="pi">:</span>
      <span class="s">Action</span><span class="pi">:</span> <span class="s">lambda:*</span>
      <span class="s">FunctionName</span><span class="pi">:</span> <span class="s">arn:aws:lambda:us-east-1:123456789:function:my-instance-termination-lambda-function</span>
      <span class="s">Principal</span><span class="pi">:</span> <span class="s">events.amazonaws.com</span>
      <span class="s">SourceArn</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="pi">[</span><span class="s1">'</span><span class="s">InstanceTerminationEvent'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">Arn'</span><span class="pi">]</span>
</code></pre></div><p>The Lambda itself is an exception; instead of creating it via a CloudFormation template, we simply defined it via the console. That way, it’s simpler to test it out as and perform code changes. Below is our Lambda - in Python - which takes the instance termination events and sends an email to our team with details around the instance that has been terminated, the time, and also the cause. In this particular case, as I mentioned above, we are only interested in instances that have been terminated due to a health check failure, so the cause on the emails will always be the same. It’s worth pointing out though that the email notification is just one option. You can also, for example, integrate your Lambda with something like <a href="https://www.pagerduty.com/">PagerDuty</a> if you wish to have more real time alerts.</p><div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">boto3</span>

<span class="c"># A wrappper for the instance termination event we get from AWS</span>
<span class="k">class</span> <span class="nc">Ec2TerminationEvent</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">detail</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s">'detail'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_id</span> <span class="o">=</span> <span class="n">detail</span><span class="p">[</span><span class="s">'EC2InstanceId'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cause</span> <span class="o">=</span> <span class="n">detail</span><span class="p">[</span><span class="s">'Cause'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminated_at</span> <span class="o">=</span> <span class="n">detail</span><span class="p">[</span><span class="s">'EndTime'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_health_check_failure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cause</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'ELB system health check failure.'</span><span class="p">)</span>
        <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">'ec2'</span><span class="p">)</span>
        <span class="c"># Fetching the instance name</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="p">(((</span><span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_instances</span><span class="p">(</span><span class="n">InstanceIds</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">instance_id</span><span class="p">])[</span><span class="s">'Reservations'</span><span class="p">])[</span><span class="mi">0</span><span class="p">])[</span><span class="s">'Instances'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">instance_tags</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="s">'Tags'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">instance_tag</span> <span class="ow">in</span> <span class="n">instance_tags</span><span class="p">:</span>
            <span class="n">tag_key</span> <span class="o">=</span> <span class="n">instance_tag</span><span class="p">[</span><span class="s">'Key'</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tag_key</span> <span class="o">==</span> <span class="s">'Name'</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instance_name</span> <span class="o">=</span> <span class="n">instance_tag</span><span class="p">[</span><span class="s">'Value'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Received EC2 termination event: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
    <span class="n">ec2_termination_event</span> <span class="o">=</span> <span class="n">Ec2TerminationEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ec2_termination_event</span><span class="o">.</span><span class="n">is_health_check_failure</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Event for instance {} is a health check failure'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ec2_termination_event</span><span class="o">.</span><span class="n">instance_id</span><span class="p">))</span>
        <span class="n">send_email</span><span class="p">(</span><span class="n">ec2_termination_event</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">'ok'</span>

<span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span><span class="n">ec2_termination_event</span><span class="p">):</span>
    <span class="n">ses_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">'ses'</span><span class="p">)</span>
    <span class="c"># Simply change the email address below to the one for your</span>
    <span class="c"># team, for example</span>
    <span class="n">destination</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'ToAddresses'</span><span class="p">:</span> <span class="p">[</span><span class="s">'your-email-address@your-domain.com'</span><span class="p">]</span> <span class="p">}</span>
    <span class="n">email_subject</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'Data'</span><span class="p">:</span> <span class="s">'EC2 Instance {} Terminated'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ec2_termination_event</span><span class="o">.</span><span class="n">instance_id</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">email_body</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'Html'</span><span class="p">:</span> <span class="p">{</span> <span class="s">'Data'</span><span class="p">:</span> <span class="n">create_message_text</span><span class="p">(</span><span class="n">ec2_termination_event</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
    <span class="n">email_message</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'Subject'</span><span class="p">:</span> <span class="n">email_subject</span><span class="p">,</span> <span class="s">'Body'</span><span class="p">:</span> <span class="n">email_body</span> <span class="p">}</span>
    <span class="c"># Also change the email addresses below to the ones applicable</span>
    <span class="c"># to your case</span>
    <span class="n">send_email_response</span> <span class="o">=</span> <span class="n">ses_client</span><span class="o">.</span><span class="n">send_email</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="s">'email-address-to-send-to@your-domain.com'</span><span class="p">,</span> <span class="n">Destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span> <span class="n">Message</span><span class="o">=</span><span class="n">email_message</span><span class="p">,</span> <span class="n">ReplyToAddresses</span><span class="o">=</span><span class="p">[</span><span class="s">'your-email-address@your-domain.com'</span><span class="p">])</span>
    <span class="n">message_id</span> <span class="o">=</span> <span class="n">send_email_response</span><span class="p">[</span><span class="s">'MessageId'</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Successfully sent email with message id {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message_id</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">create_message_text</span><span class="p">(</span><span class="n">ec2_termination_event</span><span class="p">):</span>
    <span class="n">instance_id_line</span> <span class="o">=</span> <span class="s">'&lt;b&gt;Instance&lt;/b&gt;: &lt;a href=</span><span class="se">\"</span><span class="s">https://console.aws.amazon.com/ec2/v2/home?region=us-east-1#Instances:search='</span> <span class="o">+</span> <span class="n">ec2_termination_event</span><span class="o">.</span><span class="n">instance_id</span> <span class="o">+</span> <span class="s">';sort=tag:Name</span><span class="se">\"</span><span class="s">&gt;'</span> <span class="o">+</span> <span class="n">ec2_termination_event</span><span class="o">.</span><span class="n">instance_id</span> <span class="o">+</span> <span class="s">'&lt;/a&gt;&lt;br&gt;'</span>
    <span class="n">ec2_termination_event</span><span class="o">.</span><span class="n">instance_name_line</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">if</span> <span class="n">ec2_termination_event</span><span class="o">.</span><span class="n">instance_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">instance_name_line</span> <span class="o">=</span> <span class="s">'&lt;b&gt;Instance name&lt;/b&gt;: '</span> <span class="o">+</span> <span class="n">ec2_termination_event</span><span class="o">.</span><span class="n">instance_name</span> <span class="o">+</span> <span class="s">'&lt;br&gt;'</span>
    <span class="n">cause_line</span> <span class="o">=</span> <span class="s">'&lt;b&gt;Cause&lt;/b&gt;: '</span> <span class="o">+</span> <span class="n">ec2_termination_event</span><span class="o">.</span><span class="n">cause</span> <span class="o">+</span> <span class="s">'&lt;br&gt;'</span>
    <span class="n">terminated_at_line</span> <span class="o">=</span> <span class="s">'&lt;b&gt;Terminated at&lt;/b&gt;: '</span> <span class="o">+</span> <span class="n">ec2_termination_event</span><span class="o">.</span><span class="n">terminated_at</span> <span class="o">+</span> <span class="s">'&lt;br&gt;'</span>
    <span class="k">return</span>  <span class="n">instance_id_line</span> <span class="o">+</span> <span class="n">instance_name_line</span> <span class="o">+</span> <span class="n">cause_line</span> <span class="o">+</span> <span class="n">terminated_at_line</span>
</code></pre></div><p>For our deployment notifications, the setup is fairly similar. For this, as I said before, we are only interested in events for deployments that have succeeded (even though the setup here can be easily extended to include failed deployments too!). Here is the CloudFormation template snippet for creating the rule and the permission.</p><div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">CodeDeploySuccessNotificationEvent</span><span class="pi">:</span>
    <span class="s">Type</span><span class="pi">:</span> <span class="s">AWS::Events::Rule</span>
    <span class="s">Properties</span><span class="pi">:</span>
      <span class="s">Name</span><span class="pi">:</span> <span class="s">my-deployment-successful-rule</span>
      <span class="s">State</span><span class="pi">:</span> <span class="s">ENABLED</span>
      <span class="s">Targets</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">Arn</span><span class="pi">:</span> <span class="s">arn:aws:lambda:us-east-1:123456789:function:my-deployment-successful-lambda-function</span>
          <span class="s">Id</span><span class="pi">:</span> <span class="s">my-deployment-successful-target</span>
      <span class="s">EventPattern</span><span class="pi">:</span>
        <span class="s">source</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">aws.codedeploy'</span><span class="pi">]</span>
        <span class="s">detail-type</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">CodeDeploy</span><span class="nv"> </span><span class="s">Deployment</span><span class="nv"> </span><span class="s">State-change</span><span class="nv"> </span><span class="s">Notification'</span><span class="pi">]</span>
        <span class="s">detail</span><span class="pi">:</span>
          <span class="s">state</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">SUCCESS</span><span class="pi">]</span>
          <span class="s">application</span><span class="pi">:</span> <span class="pi">[</span><span class="kt">!Ref</span> <span class="nv">YourCodedeployApplication</span><span class="pi">]</span>
<span class="s">CodeDeploySuccessNotificationEventLambdaPermission</span><span class="pi">:</span>
    <span class="s">Type</span><span class="pi">:</span> <span class="s">AWS::Lambda::Permission</span>
    <span class="s">Properties</span><span class="pi">:</span>
      <span class="s">Action</span><span class="pi">:</span> <span class="s">lambda:*</span>
      <span class="s">FunctionName</span><span class="pi">:</span> <span class="s">arn:aws:lambda:us-east-1:123456789:function:my-deployment-successful-lambda-function</span>
      <span class="s">Principal</span><span class="pi">:</span> <span class="s">events.amazonaws.com</span>
      <span class="s">SourceArn</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="pi">[</span><span class="s1">'</span><span class="s">CodeDeploySuccessNotificationEvent'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">Arn'</span><span class="pi">]</span>
</code></pre></div><p>And below is the Lambda that receives the event, and sends out an email notification. On the email it will be included the application name, the deployment group where the deployment has happened, as well as the release version. Our actual Lambda in production also fires a deployment notification to NewRelic. In there you have a history of the releases for a given service, and how metrics have changed since each release. That can come in handy when establishing timelines and finding out exactly which release is broken.</p><div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">httplib</span>

<span class="c"># A wrapper for the deployment successful we receive</span>
<span class="c"># from CodeDeploy. Extracs the application, deployment</span>
<span class="c"># group, release version, etc.</span>
<span class="k">class</span> <span class="nc">CodeDeployEvent</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">detail</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s">'detail'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">detail</span><span class="p">[</span><span class="s">'application'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deployment_id</span> <span class="o">=</span> <span class="n">detail</span><span class="p">[</span><span class="s">'deploymentId'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deployment_group</span> <span class="o">=</span> <span class="n">detail</span><span class="p">[</span><span class="s">'deploymentGroup'</span><span class="p">]</span>
        <span class="n">codedeploy_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">'codedeploy'</span><span class="p">)</span>
        <span class="n">deployment</span> <span class="o">=</span> <span class="n">codedeploy_client</span><span class="o">.</span><span class="n">get_deployment</span><span class="p">(</span><span class="n">deploymentId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release_file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">revision</span> <span class="o">=</span> <span class="p">(</span><span class="n">deployment</span><span class="p">[</span><span class="s">'deploymentInfo'</span><span class="p">])[</span><span class="s">'revision'</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">revision</span><span class="p">[</span><span class="s">'revisionType'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'S3'</span><span class="p">):</span>
            <span class="n">s3_location</span> <span class="o">=</span> <span class="n">revision</span><span class="p">[</span><span class="s">'s3Location'</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">release_file</span> <span class="o">=</span> <span class="n">s3_location</span><span class="p">[</span><span class="s">'key'</span><span class="p">]</span>
            <span class="n">last_slash_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">release_file</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
            <span class="n">last_dot_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">release_file</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">release_file</span><span class="p">[</span><span class="n">last_slash_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">last_dot_index</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">code_deploy_event</span> <span class="o">=</span> <span class="n">CodeDeployEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Received success deploy {} for application {} and deployment group {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">code_deploy_event</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">,</span> <span class="n">code_deploy_event</span><span class="o">.</span><span class="n">application</span><span class="p">,</span> <span class="n">code_deploy_event</span><span class="o">.</span><span class="n">deployment_group</span><span class="p">))</span>
    <span class="n">send_email</span><span class="p">(</span><span class="n">code_deploy_event</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">'ok'</span>

<span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span><span class="n">code_deploy_event</span><span class="p">):</span>
    <span class="n">ses_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">'ses'</span><span class="p">)</span>
    <span class="c"># Simply change the email address below to the one for your</span>
    <span class="c"># team, for example</span>
    <span class="n">destination</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'ToAddresses'</span><span class="p">:</span> <span class="p">[</span><span class="s">'your-email-address@your-domain.com'</span><span class="p">]</span> <span class="p">}</span>
    <span class="n">email_subject</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'Data'</span><span class="p">:</span> <span class="s">'Deployment {} Successful'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">code_deploy_event</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">email_body</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'Html'</span><span class="p">:</span> <span class="p">{</span> <span class="s">'Data'</span><span class="p">:</span> <span class="n">create_message_text</span><span class="p">(</span><span class="n">code_deploy_event</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
    <span class="n">email_message</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'Subject'</span><span class="p">:</span> <span class="n">email_subject</span><span class="p">,</span> <span class="s">'Body'</span><span class="p">:</span> <span class="n">email_body</span> <span class="p">}</span>
    <span class="n">send_email_response</span> <span class="o">=</span> <span class="n">ses_client</span><span class="o">.</span><span class="n">send_email</span><span class="p">(</span><span class="n">Source</span><span class="o">=</span><span class="s">'email-address-to-send-to@your-domain.com'</span><span class="p">,</span> <span class="n">Destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span> <span class="n">Message</span><span class="o">=</span><span class="n">email_message</span><span class="p">,</span> <span class="n">ReplyToAddresses</span><span class="o">=</span><span class="p">[</span><span class="s">'your-email-address@your-domain.com'</span><span class="p">])</span>
    <span class="n">message_id</span> <span class="o">=</span> <span class="n">send_email_response</span><span class="p">[</span><span class="s">'MessageId'</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Successfully sent email with message id {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message_id</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">create_message_text</span><span class="p">(</span><span class="n">code_deploy_event</span><span class="p">):</span>
    <span class="n">deployment_id_line</span> <span class="o">=</span> <span class="s">'&lt;b&gt;Deployment id&lt;/b&gt;: &lt;a href=</span><span class="se">\"</span><span class="s">https://console.aws.amazon.com/codedeploy/home?region=us-east-1#/deployments/'</span> <span class="o">+</span> <span class="n">code_deploy_event</span><span class="o">.</span><span class="n">deployment_id</span> <span class="o">+</span> <span class="s">'</span><span class="se">\"</span><span class="s">&gt;'</span> <span class="o">+</span> <span class="n">code_deploy_event</span><span class="o">.</span><span class="n">deployment_id</span> <span class="o">+</span> <span class="s">'&lt;/a&gt;&lt;br&gt;'</span>
    <span class="n">version_line</span> <span class="o">=</span> <span class="s">'&lt;b&gt;Revision&lt;/b&gt;: '</span> <span class="o">+</span> <span class="n">code_deploy_event</span><span class="o">.</span><span class="n">version</span> <span class="o">+</span> <span class="s">'&lt;br&gt;'</span>
    <span class="n">application_line</span> <span class="o">=</span> <span class="s">'&lt;b&gt;Application&lt;/b&gt;: '</span> <span class="o">+</span> <span class="n">code_deploy_event</span><span class="o">.</span><span class="n">application</span> <span class="o">+</span> <span class="s">'&lt;br&gt;'</span>
    <span class="n">deployment_group_line</span> <span class="o">=</span> <span class="s">'&lt;b&gt;Deployment group&lt;/b&gt;: '</span> <span class="o">+</span> <span class="n">code_deploy_event</span><span class="o">.</span><span class="n">deployment_group</span>
    <span class="k">return</span> <span class="n">deployment_id_line</span> <span class="o">+</span> <span class="n">version_line</span> <span class="o">+</span> <span class="n">application_line</span> <span class="o">+</span> <span class="n">deployment_group_line</span>
</code></pre></div><h1 id="final-thoughts">Final Thoughts</h1><p>We have had this setup running in one of our teams here at <a href="http://www.gilt.com">Gilt</a> for quite a few months now, and the results are satisfying. Instance termination events, given their real time nature, allow us, for example, to act quickly and prevent potential outages on our services. Also, it has already allowed us to identify services that had not enough memory allocated, and thus needed code changes or a change of instance type in order to stabilize them. In short, it’s giving us a level visibility we never really had before and enabling us to be more proactive towards keeping our services in good shape.</p><p>Finally, deployment notifications add more to the debugging side of things. They let us establish a timeline of events - e.g., when releases have gone out - and with that more quickly identify releases and code changes that have broken a particular service in production. Ultimately, this speeds up the process of bringing a service back to a healthy state. We feel like our current setup is enough for our needs, but certainly we will be looking at expanding the range of events we are watching out for when the need arises. At the end of the day, it’s all about having quality information in order to help keep our services running well.</p></div><footer class="article__content__footer"><div class="article-tags"><span class="article-tags__tag">aws</span><span>,</span> <span class="article-tags__tag">cloudwatch</span><span>,</span> <span class="article-tags__tag">events</span><span>,</span> <span class="article-tags__tag">lambda</span><span>,</span> <span class="article-tags__tag">production</span></div><section class="author"><svg class="author__avatar" height="36" width="36" xmlns="http://www.w3.org/2000/svg"><use class="hbc-svg-icon hbc-svg-icon--avatar__circle" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#circle"></use><use class="hbc-svg-icon hbc-svg-icon--avatar__head" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#head"></use><use class="hbc-svg-icon hbc-svg-icon--avatar__body" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#body"></use></svg><span class="author__name">Emerson Loureiro</span></section></footer></section></article><aside class="recirc"><h2 class="header__title">More Insights</h2><a class="header__view-all-link" href="https://saksdirect.github.io/hbc-tech-blog/insights/index.html">Explore</a><div class="recirc__articles"><article class="recirc__articles__item"><section class="snippet"><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2016/02/10/codedeploy-notifications/"></a><h1 class="snippet__title"><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2016/02/10/codedeploy-notifications/" class="snippet__link" title="Codedeploy Notifications as a Service">Codedeploy Notifications as a Service</a></h1><div class="snippet__meta"><span class="meta__day">10</span> <span class="meta__month">FEB</span> <span class="meta__year">2016</span> <a class="meta__category-link" href="https://saksdirect.github.io/hbc-tech-blog/categories/#aws">aws</a>Emerson Loureiro</div><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2016/02/10/codedeploy-notifications/" class="snippet__link" title="Codedeploy Notifications as a Service"><p class="snippet__excerpt">After moving our software stack to AWS, some of us here at Gilt have started deploying our services to production using AWS’s Codedeploy. Before that, in a not-so-distant past, we used an in-house tool for deployments - IonCannon. One of the things IonCannon provided were deployment notifications. In particular, it would:</p></a></section></article><article class="recirc__articles__item"><section class="snippet"><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2017/05/19/cloudformation-nanoservice/"></a><h1 class="snippet__title"><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2017/05/19/cloudformation-nanoservice/" class="snippet__link" title="CloudFormation Nanoservice">CloudFormation Nanoservice</a></h1><div class="snippet__meta"><span class="meta__day">19</span> <span class="meta__month">MAY</span> <span class="meta__year">2017</span> <a class="meta__category-link" href="https://saksdirect.github.io/hbc-tech-blog/categories/#aws">aws</a>Ryan Martin</div><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2017/05/19/cloudformation-nanoservice/" class="snippet__link" title="CloudFormation Nanoservice"><p class="snippet__excerpt">One of the big HBC Digital initiatives for 2017 is “buy online, pickup in store” - somewhat awkwardly nicknamed “BOPIS” internally. This is the option for the customer to, instead of shipping an order to an address, pick it up in a store that has the items in inventory.</p></a></section></article><article class="recirc__articles__item"><section class="snippet"><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2017/02/06/sundial-pagerduty-integration/"></a><h1 class="snippet__title"><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2017/02/06/sundial-pagerduty-integration/" class="snippet__link" title="Sundial PagerDuty Integration">Sundial PagerDuty Integration</a></h1><div class="snippet__meta"><span class="meta__day">6</span> <span class="meta__month">FEB</span> <span class="meta__year">2017</span> <a class="meta__category-link" href="https://saksdirect.github.io/hbc-tech-blog/categories/#aws">aws</a>Giovanni Gargiulo</div><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2017/02/06/sundial-pagerduty-integration/" class="snippet__link" title="Sundial PagerDuty Integration"><p class="snippet__excerpt">Sundial</p></a></section></article><article class="recirc__articles__item"><section class="snippet"><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2016/04/01/mega-service-gilt/"></a><h1 class="snippet__title"><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2016/04/01/mega-service-gilt/" class="snippet__link" title="Breaking the Mold: Megaservice Architecture at Gilt">Breaking the Mold: Megaservice Architecture at Gilt</a></h1><div class="snippet__meta"><span class="meta__day">1</span> <span class="meta__month">APR</span> <span class="meta__year">2016</span> <a class="meta__category-link" href="https://saksdirect.github.io/hbc-tech-blog/categories/#aws">aws</a>Adrian Trenaman</div><a href="https://saksdirect.github.io/hbc-tech-blog/aws/2016/04/01/mega-service-gilt/" class="snippet__link" title="Breaking the Mold: Megaservice Architecture at Gilt"><p class="snippet__excerpt">Today we announce a novel approach to software and system architecture that we’ve been experimenting with for the last while at Gilt: internally, we’ve been referring to it ‘mega-service’ architecture, and, the name seems to have stuck. We’re pretty excited about it, as it represents a real paradigm shift for us.</p></a></section></article></div></aside></section><footer class="footer"><section class="footer__links"><ul class="social-links social-links__list"><li class="social-links__list-item"><a class="social-links__link" rel="next" href="#"><svg class="social-links__icon" xmlns="http://www.w3.org/2000/svg"><use class="linkedin" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#linkedin"></use></svg></a></li><li class="social-links__list-item"><a class="social-links__link" rel="next" href="#"><svg class="social-links__icon" xmlns="http://www.w3.org/2000/svg"><use class="twitter" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#twitter"></use></svg></a></li><li class="social-links__list-item"><a class="social-links__link" rel="next" href="#"><svg class="social-links__icon" xmlns="http://www.w3.org/2000/svg"><use class="instagram" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://saksdirect.github.io/hbc-tech-blog/assets/images/hbc-icons.svg#instagram"></use></svg></a></li></ul><ul class="navigation navigation--footer"><li class="navigation__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/insights" class="navigation__link"><span class="navigation__link-highlight">Insights</span></a></li><li class="navigation__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/code" class="navigation__link"><span class="navigation__link-highlight">Code</span></a></li><li class="navigation__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/culture" class="navigation__link"><span class="navigation__link-highlight">Culture</span></a></li><li class="navigation__link-item"><a href="https://saksdirect.github.io/hbc-tech-blog/jobs" class="navigation__link"><span class="navigation__link-highlight">Work Here</span></a></li></ul></section><p class="copyright">&copy; 2017 HBC Tech</p></footer><script type="text/javascript" src="https://saksdirect.github.io/hbc-tech-blog/assets/js/vendor/scrollmagic/ScrollMagic.min.js"></script><script type="text/javascript" src="https://saksdirect.github.io/hbc-tech-blog/assets/js/vendor/scrollmagic/debug.addIndicators.min.js"></script><script type="text/javascript" src="https://saksdirect.github.io/hbc-tech-blog/assets/js/main.js"></script></body></html>